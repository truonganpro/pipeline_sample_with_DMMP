"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{35232:function(e,n,r){r.d(n,{_:function(){return s}});var t=r(73235),u=r(20958);function l(){let e=(0,t._)(["\n  query InstanceConfigHasInfo {\n    instance {\n      id\n      hasInfo\n    }\n  }\n"]);return l=function(){return e},e}let s=()=>{var e;return!!(null===(e=(0,u.aM)(i).data)||void 0===e?void 0:e.instance.hasInfo)},i=(0,u.Ps)(l())},38267:function(e,n,r){r.d(n,{Q1:function(){return y},Qf:function(){return C},zc:function(){return j}});var t=r(73235),u=r(52322),l=r(38491),s=r(39013),i=r(18149),o=r.n(i),a=r(2784),d=r(7267),c=r(35505),f=r(59351),h=r(52338),p=r(20958),v=r(20171),m=r(88610);function x(){let e=(0,t._)(["\n  query RunTabsCountQuery($queuedFilter: RunsFilter!, $inProgressFilter: RunsFilter!) {\n    queuedCount: pipelineRunsOrError(filter: $queuedFilter) {\n      ... on Runs {\n        count\n      }\n    }\n    inProgressCount: pipelineRunsOrError(filter: $inProgressFilter) {\n      ... on Runs {\n        count\n      }\n    }\n  }\n"]);return x=function(){return e},e}let g=e=>{switch(e){case"all":return"Runs | All runs";case"failed":return"Runs | Failed";case"in-progress":return"Runs | In progress";case"queued":return"Runs | Queued";case"scheduled":return"Runs | Scheduled";default:return"Runs"}},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,p.aM)(R,{variables:{queuedFilter:{...e,statuses:Array.from(f.sy)},inProgressFilter:{...e,statuses:Array.from(f.Ys)}}}),{data:r}=n,{queuedCount:t,inProgressCount:s}=(0,a.useMemo)(()=>{var e,n;return{queuedCount:(null==r?void 0:null===(e=r.queuedCount)||void 0===e?void 0:e.__typename)==="Runs"?r.queuedCount.count:null,inProgressCount:(null==r?void 0:null===(n=r.inProgressCount)||void 0===n?void 0:n.__typename)==="Runs"?r.inProgressCount.count:null}},[r]),[i]=(0,h.oD)(),o=C(i);(0,v.j)(g(o));let d=e=>{let n=i.filter(e=>"status"!==e.token),r=e.map(e=>({token:"status",value:e}));return(0,h.it)([...r,...n])};return{tabs:(0,u.jsxs)(l.zH,{children:[(0,u.jsx)(y,{to:d([]),id:"all",$active:"all"===o,children:"All runs"}),(0,u.jsxs)(y,{to:d(Array.from(f.sy)),id:"queued",$active:"queued"===o,children:["Queued (",null!=t?t:"indeterminate",")"]}),(0,u.jsxs)(y,{to:d(Array.from(f.Ys)),id:"in-progress",$active:"in-progress"===o,children:["In progress (",null!=s?s:"indeterminate",")"]}),(0,u.jsx)(y,{to:d(Array.from(f.hd)),id:"failed",$active:"failed"===o,children:"Failed"}),(0,u.jsx)(y,{title:"Scheduled",to:"/runs/scheduled",id:"scheduled",$active:"scheduled"===o,children:"Scheduled"})]}),queryResult:n}},y=(0,c.ZP)(m.A).withConfig({componentId:"sc-56e7dbb1-0"})(["color:",";&&:hover{color:",";}",""],s.$(),s.$(),e=>{let{$active:n}=e;return n?(0,c.iv)(["background-color:",";color:",";&&:hover{background-color:",";color:",";}"],s.AU(),s.Ep(),s.AU(),s.Ep()):(0,c.iv)(["background-color:",";"],s.v8())}),C=e=>{let{pathname:n}=(0,d.TH)();if("/runs/timeline"===n)return"timeline";if("/runs/scheduled"===n)return"scheduled";if("/overview/backfills"===n)return"backfills";let r=new Set(e.filter(e=>"status"===e.token).map(e=>e.value));return o()(f.sy,r)?"queued":o()(f.Ys,r)?"in-progress":o()(f.hd,r)?"failed":"all"},R=(0,p.Ps)(x())},6268:function(e,n,r){r.r(n),r.d(n,{RunsRoot:function(){return z},default:function(){return V}});var t=r(52322),u=r(49853),l=r(14934),s=r(49308),i=r(74580),o=r(35292),a=r(37483),d=r(89891),c=r(80122),f=r(96795),h=r.n(f),p=r(2784),v=r(73235),m=r(16629),x=r(47933),g=r(20958),j=r(9108),y=r(35232);function C(){let e=(0,v._)(['\n  query QueueDaemonStatusQuery {\n    instance {\n      id\n      daemonHealth {\n        id\n        daemonStatus(daemonType: "QUEUED_RUN_COORDINATOR") {\n          id\n          daemonType\n          healthy\n          required\n        }\n      }\n    }\n  }\n']);return C=function(){return e},e}let R=()=>{let e=(0,y._)();return(0,t.jsxs)(l.x,{flex:{direction:"column",gap:8},style:{minWidth:"100%"},border:"bottom",children:[e&&(0,t.jsx)(m.b,{intent:"info",title:(0,t.jsx)(x.rU,{to:"/config#run_coordinator",children:"View queue configuration"})}),e&&(0,t.jsx)(q,{})]})},q=()=>{let{data:e}=(0,g.aM)(b),{pageTitle:n}=(0,p.useContext)(j.N),r=null==e?void 0:e.instance.daemonHealth.daemonStatus;return(null==r?void 0:r.required)&&!(null==r?void 0:r.healthy)?(0,t.jsx)(m.b,{intent:"warning",title:"The queued run coordinator is not healthy.",description:(0,t.jsxs)("div",{children:["View ",(0,t.jsx)(x.rU,{to:"/health",children:n})," for details."]})}):null},b=(0,g.Ps)(C());var k=r(38267),_=r(59351),w=r(53040),E=r(33182),A=r(52338),P=r(38491),T=r(18149),F=r.n(T),$=r(96569);function I(){let e=(0,v._)(["\n  query TerminateRunIdsQuery($filter: RunsFilter!) {\n    pipelineRunsOrError(filter: $filter) {\n      ... on Runs {\n        results {\n          id\n          status\n          canTerminate\n        }\n      }\n    }\n  }\n"]);return I=function(){return e},e}let Q=e=>{let{refetch:n,filter:r,disabled:u}=e,[l,s]=(0,p.useState)(null),i=(0,g.xJ)(),o=async()=>{let e=await i.query({query:S,variables:{filter:r}});s("Runs"===e.data.pipelineRunsOrError.__typename?Object.fromEntries(e.data.pipelineRunsOrError.results.map(e=>[e.id,e.canTerminate])):{})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)($.A,{isOpen:null!==l,selectedRuns:l||{},selectedRunsAllQueued:F()(r,{statuses:Array.from(_.sy)}),onClose:()=>s(null),onComplete:()=>n()}),(0,t.jsx)(P.zx,{intent:"danger",outlined:!0,disabled:u,onClick:o,children:"Terminate allâ€¦"})]})},S=(0,g.Ps)(I());var O=r(74928),H=r(16336),N=r(69737),U=r(28316);function Y(e){let{node:n}=e,r=p.useRef(null);return p.useLayoutEffect(()=>{let e=r.current;if(n.parentNode!==e){if(null!==n.parentNode&&n.parentNode!==e)throw Error("Cannot render the same node twice");return null==e||e.appendChild(n),()=>{null==e||e.removeChild(n)}}},[n]),(0,t.jsx)("div",{ref:r})}var D=r(59923),M=r(85062);let z=()=>{(0,N.Px)();let[e,n]=(0,A.oD)(),r=(0,A.VH)(e),{queryResult:f,paginationProps:v}=(0,O.E)(r,25),m=(0,H.C4)(f,H.dT),x=(0,k.Qf)(e),g="all"!==x,[j,y]=h()(e,e=>"status"===e.token),C=(0,p.useCallback)(e=>{g?n([...j,...e]):n(e)},[n,g,j]),q=(0,p.useCallback)(e=>{let n=(0,u.HY)(e);y.some(e=>(0,u.HY)(e)===n)||C([...y,e])},[y,C]),b=(0,p.useMemo)(()=>{let e=["tag","snapshotId","id","job","pipeline","partition","backfill"];return g||e.push("status"),e},[g]),P=(0,p.useMemo)(()=>g?e.filter(e=>"status"!==e.token):e,[e,g]),{tabs:T,queryResult:F}=(0,k.zc)(r),$=(0,H.C4)(F,H.dT),I=(0,H.V5)($,m),{button:S,activeFiltersJsx:z}=(0,A.Vv)({tokens:P,onChange:C,enabledFilters:b}),[V,L]=function(e){let[n,r]=p.useState(null);return p.useLayoutEffect(()=>{r(e=>null===e?document.createElement("div"):e)},[]),[n?(0,U.createPortal)(e,n):null,n?(0,t.jsx)(Y,{node:n}):null]}(S);function B(){var e,n,u,s;return(0,t.jsxs)(l.x,{style:{width:"100%",marginRight:8},flex:{justifyContent:"space-between"},children:[(0,t.jsxs)(l.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[T,L]}),"queued"===x?(0,t.jsx)(Q,{refetch:I.refetch,filter:{...r,statuses:Array.from(_.sy)},disabled:(null===(e=F.data)||void 0===e?void 0:e.queuedCount.__typename)!=="Runs"||(null===(n=F.data)||void 0===n?void 0:n.queuedCount.count)===0}):"in-progress"===x?(0,t.jsx)(Q,{refetch:I.refetch,filter:{...r,statuses:Array.from(_.Ys)},disabled:(null===(u=F.data)||void 0===u?void 0:u.inProgressCount.__typename)!=="Runs"||(null===(s=F.data)||void 0===s?void 0:s.inProgressCount.count)===0}):void 0]})}return(0,t.jsxs)(s.T,{children:[(0,t.jsx)(i.m,{title:(0,t.jsx)(o.X6,{children:"Runs"}),right:(0,t.jsx)(H.xi,{refreshState:I})}),V,(0,t.jsx)(E.Lw.Provider,{value:{refetch:f.refetch},children:(0,t.jsx)(D.g,{queryResult:f,allowStaleData:!0,renderError:e=>{let n=!!((null==e?void 0:e.networkError)&&"statusCode"in e.networkError&&400===e.networkError.statusCode);return(0,t.jsxs)(l.x,{flex:{direction:"column",gap:32},padding:{vertical:8,horizontal:24},children:[B(),(0,t.jsx)(a.t,{icon:"warning",title:n?"Invalid run filters":"Unexpected error",description:n?"The specified run filters are not valid. Please check the filters and try again.":"An unexpected error occurred. Check the console for details."})]})},children:e=>{let{pipelineRunsOrError:n}=e;return"Runs"!==n.__typename?(0,t.jsx)(l.x,{padding:{vertical:64},children:(0,t.jsx)(a.t,{icon:"error",title:"Query Error",description:n.message})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.Y,{$top:0,children:(0,t.jsx)(w.A,{runs:n.results,onAddTag:q,filter:r,actionBarComponents:B(),belowActionBarComponents:"queued"===x||z.length?(0,t.jsxs)(t.Fragment,{children:["queued"===x&&(0,t.jsx)(R,{}),z.length>0&&(0,t.jsxs)(t.Fragment,{children:[z,(0,t.jsx)(d.Z,{onClick:()=>C([]),children:"Clear all"})]})]}):null})}),n.results.length>0?(0,t.jsx)("div",{style:{marginTop:"16px"},children:(0,t.jsx)(c.pI,{...v})}):null]})}})})]})};var V=z}}]);
//# sourceMappingURL=6268.8e8bfe7cc6f714cd.js.map